<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Todo List</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
  <link rel="stylesheet" href="styles/dash.css">

</head>

<body>
  <div class="container">
    <div class="sidebar">

      <a href="dash.html">
        <button class="btn-add-todo">Dash Board</button></a>
      <a href="add.html">
        <button class="btn-add-todo">Add product</button></a>
      <a href="cartegory.html"> <button class="btn-add-todo">Add Category</button></a>



      <div><a href="adminlogin.html"
          style="padding: 10px;background-color: blanchedalmond;text-decoration: none;color: black;">Sign Out</a></div>
    </div>
    <div class="main-content">
      <div class="header">My</div>






      <div id="product-list">
        <h2>Products Added:</h2>
        <div id="products-container"></div>
      </div>

    </div>
  </div>


  <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
  <script>
    $(document).ready(function () {
      console.log('working')



      function getPost() {
        let merchantId = localStorage.getItem('user');
        console.log(merchantId)
        $.ajax({
          type: "get",
          url: `http://ecommerce.reworkstaging.name.ng/v2/products?merchant_id=${merchantId}`,
          success: function (res) {
            // console.log(res)

            let productsContainer = $('#products-container');
            productsContainer.empty();

            if (res.length === 0) {
              productsContainer.append('<p>No products available.</p>');
              return;
            }


            res.data.forEach(product => {


              let imagesHtml = '';

              // Assuming product.images is an array of image URLs
              product.images.forEach(imageUrl => {
                imagesHtml += `<img src="${imageUrl}" alt="${product.title}" style="width: 100px; height: 100px; margin-right: 10px;" />`;
              });

              let productCard = `
 <div class="product-card" data-id="${product.id}">
                                    <div class="product-images">
                                ${imagesHtml}  <!-- Display all images -->
                            </div>
                                    <h3>${product.title}</h3>
                                    <p><strong>Description:</strong> ${product.descp}</p>
                                    <p><strong>Price:</strong> ${product.price}</p>
                                    <p><strong>Brand:</strong> ${product.brand}</p>
                                    <p><strong>Quantity:</strong> ${product.quantity}</p>
                                    <p><strong>Currency:</strong> ${product.currency}</p>
                                    <p><strong>Discount:</strong> ${product.discount}%</p>

                                    <!-- Action buttons for Edit and Delete -->
                                    <div class="action-buttons">
                                        <button class="edit-btn" data-id="${product.id}">Edit</button>
                                        <button class="delete-btn" data-id="${product.id}">Delete</button>
                                    </div>
                                </div>
                            `;
              productsContainer.append(productCard);
            });
            editAndDelete();
          },
          error: function (error) {
            console.error('Error fetching products:', error);
            $('#products-container').append('<p>Failed to load products.</p>');
          }
        });
      }
      function editAndDelete() {
        $('.edit-btn').on('click', function () {
          let productId = $(this).data('id');
          // go to an  where you can edit the product or ha
          window.location.href = `edit.html?product_id=${productId}`;
        });

        // Delete button click handler
        $('.delete-btn').on('click', function () {
          let productId = $(this).data('id');
          if (confirm('Are you sure you want to delete this product?')) {
            deleteProduct(productId);
          }
        });
      }

      // Function to delete a product
      function deleteProduct(productId) {
        $.ajax({
          url: `http://ecommerce.reworkstaging.name.ng/v2/products/${productId}`,
          type: 'DELETE',
          success: function (res) {
            alert('Product deleted successfully');
            getPost(); // Refresh the product list
          },
          error: function (error) {
            console.error('Error deleting product:', error);
            alert('Failed to delete product');
          }
        });
      }

      getPost()
    })
  </script>
</body>

</html>